import { ContentRestorer } from "../../asset/ContentRestorer";
import { Logger } from "../../base";
import { Engine } from "../../Engine";
import { TextureFormat, TextureWrapMode } from "../../texture";
import { Texture2D } from "../../texture/Texture2D";

export class PrefilteredDFG {
  private static _size = 256;
  private static _base64 = `data:image/png;base64,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dTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF1GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDIgNzkuYTZhNjM5NjhhLCAyMDI0LzAzLzA2LTExOjUyOjA1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjUuMTIgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDI0LTEyLTEyVDE4OjIwOjQwKzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNC0xMi0xM1QxMzoxNjozMSswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNC0xMi0xM1QxMzoxNjozMSswODowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTBhZWJkMjMtOGJlMi00OTBlLWEzOGItZmEwMDQwODNmMTJmIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2Np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`;

  static create(engine: Engine): Promise<Texture2D> {
    return new Promise((resolve, reject) => {
      const texture = new Texture2D(
        engine,
        PrefilteredDFG._size,
        PrefilteredDFG._size,
        TextureFormat.R8G8B8,
        false,
        false
      );
      texture.wrapModeU = texture.wrapModeV = TextureWrapMode.Clamp;
      texture.isGCIgnored = true;

      const image = new Image();

      image.onload = () => {
        texture.setImageSource(image);
        resolve(texture);
      };

      image.onerror = image.onabort = () => {
        const message = "Failed to load prefiltered LUT image.";
        Logger.error(message);
        reject(message);
      };

      image.src = PrefilteredDFG._base64;

      engine.resourceManager.addContentRestorer(
        new (class extends ContentRestorer<Texture2D> {
          constructor() {
            super(texture);
          }
          restoreContent() {
            texture.setImageSource(image);
          }
        })()
      );

      return texture;
    });
  }
}
